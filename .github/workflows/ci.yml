name: CI

on:
  pull_request:
  push:
    branches:
      - main

jobs:
  required-check:
    name: required-check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate merge conflict markers
        run: |
          if git grep -n -E '^(<<<<<<< |>>>>>>> )' -- .; then
            echo "Merge conflict markers found in tracked files."
            exit 1
          fi

      - name: Validate forbidden secret-like files are not tracked
        run: |
          forbidden_regex='(^|/)(\.env|\.env\..*|id_rsa|id_dsa|id_ed25519|.*\.pem)$'
          if git ls-files | grep -E "$forbidden_regex"; then
            echo "Forbidden secret-like files are tracked by git."
            exit 1
          fi

      - name: Validate collaboration templates are present
        run: |
          test -f .github/PULL_REQUEST_TEMPLATE.md
          test -f .github/ISSUE_TEMPLATE/bug_report.md
          test -f .github/ISSUE_TEMPLATE/feature_request.md

